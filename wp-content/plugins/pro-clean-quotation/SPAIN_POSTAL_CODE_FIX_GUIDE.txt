================================================================================
  PRO CLEAN QUOTATION - SPAIN POSTAL CODE FIX GUIDE
  Issue: Postal Code 26960 and Others Being Rejected
================================================================================

üìã ISSUE SUMMARY
----------------
Error Message: "Sorry, we currently do not service postal code 26960. Please 
contact us at info@webblymedia.se for more information about our service areas."

Root Cause: The database has service area restrictions configured. The 
'service_area_postcodes' option contains specific postal codes or ranges, 
which means the system is NOT accepting all Spanish postal codes by default.

Expected Behavior: Accept ALL valid Spanish postal codes (01001-52999) when 
no specific service area is configured.

================================================================================

‚úÖ SOLUTION - QUICK FIX (2 MINUTES)
-----------------------------------

Option 1: Use the Automated Fix Tool (RECOMMENDED)
1. Open your browser and navigate to:
   http://localhost/wecleaning/wp-content/plugins/pro-clean-quotation/fix-service-area-spain.php

2. Login as WordPress administrator

3. Review the current configuration status

4. Click the button: "Clear Service Area Restrictions - Accept All Spain"

5. The fix will be applied immediately

6. Test with postal code 26960 on your quote form


Option 2: Manual Fix via Settings Panel
1. Login to WordPress Admin Panel

2. Go to: Pro Clean Quotation ‚Üí Settings

3. Look for the "Service Area" field

4. Clear the textarea completely (make sure it's empty, no spaces)

5. Click "Save Settings"

6. Test with postal code 26960 on your quote form


Option 3: Manual Database Fix (Advanced)
1. Access your database (phpMyAdmin or MySQL command line)

2. Run this SQL query:
   
   UPDATE wp_options 
   SET option_value = 'a:0:{}' 
   WHERE option_name = 'pcq_service_area_postcodes';

3. This sets the service area to an empty array

4. Test with postal code 26960 on your quote form

================================================================================

üß™ TESTING THE FIX
------------------

Test Tool 1: Comprehensive Test Suite
URL: http://localhost/wecleaning/wp-content/plugins/pro-clean-quotation/test-spain-postal-codes.php

This will test:
- Format validation for Spanish postal codes
- Service area acceptance for all regions
- Rejection of invalid codes
- Postal code 26960 specifically

Expected Results: All tests should PASS (100% success rate)


Test Tool 2: Live Quote Form
1. Navigate to: http://localhost/wecleaning/ (or your quote form page)

2. Fill in the quote form with these test postal codes:
   - 26960 (Chiclana de la Frontera, C√°diz) ‚úÖ Should be accepted
   - 28001 (Madrid) ‚úÖ Should be accepted
   - 08001 (Barcelona) ‚úÖ Should be accepted
   - 01001 (√Ålava) ‚úÖ Should be accepted
   - 52999 (Melilla) ‚úÖ Should be accepted

3. All should be accepted without errors

================================================================================

üìä TECHNICAL EXPLANATION
------------------------

How Service Area Configuration Works:

1. EMPTY CONFIGURATION (Default - All Spain Enabled)
   - Database value: [] (empty array)
   - Result: ALL Spanish postal codes (01001-52999) are accepted
   - This is the RECOMMENDED setting for serving all of Spain

2. CONFIGURED RESTRICTIONS
   - Database has specific postal codes/ranges
   - Examples: ['28001', '29600-29699', '08***']
   - Result: ONLY matching postal codes are accepted
   - All other codes are rejected with the error message

The Issue:
Your database currently has service area restrictions configured, which is why 
postal code 26960 (and potentially many others) are being rejected.

The Fix:
Clear the service area configuration to return to the default "accept all Spain" 
mode. This is controlled by setting the database option to an empty array.

================================================================================

üîß FILES CREATED/MODIFIED
--------------------------

New Files Created:
1. fix-service-area-spain.php
   - Interactive database fix tool with visual interface
   - Shows current configuration status
   - One-click fix to clear restrictions
   
2. test-spain-postal-codes.php
   - Comprehensive test suite for postal code validation
   - Tests all Spanish regions and edge cases
   - Visual reporting of test results

3. SPAIN_POSTAL_CODE_FIX_GUIDE.txt
   - This file - complete fix documentation

Existing Files (No Changes Needed):
- ValidationService.php - Already handles empty array correctly
- SettingsPage.php - Already has clear button and warnings
- FormHandler.php - Already validates using checkServiceArea()

The code is working correctly! The issue is purely a configuration/database 
setting that needs to be cleared.

================================================================================

üìñ SPANISH POSTAL CODE FORMAT
------------------------------

Valid Range: 01001 to 52999

Structure: PPXXX
- PP = Province code (01-52)
- XXX = Locality code within province (000-999)

Province Examples:
- 01 = √Ålava
- 08 = Barcelona
- 26 = La Rioja (where 26960 belongs)
- 28 = Madrid
- 29 = M√°laga
- 41 = Sevilla
- 46 = Valencia
- 52 = Melilla (highest)

Total Valid Codes: Approximately 52,000 postal codes

================================================================================

‚öôÔ∏è SERVICE AREA CONFIGURATION OPTIONS
--------------------------------------

After fixing the issue, you can optionally configure service areas:

1. Accept All Spain (Default - Recommended)
   - Leave the field empty
   - Accepts codes: 01001-52999

2. Specific Postal Codes
   - Example: 28001, 08001, 41001
   - Only these exact codes are accepted

3. Ranges
   - Example: 28001-28099
   - Accepts all codes in the range

4. Wildcards
   - Example: 28*** (All Madrid province)
   - Example: 296** (29600-29699)
   - Example: 2**** (All provinces starting with 2)

5. Combined
   - Example: 28***, 08***, 41***, 46***
   - Multiple provinces/regions

Current Recommendation: Leave EMPTY to serve all of Spain (01001-52999)

================================================================================

üõ°Ô∏è BACKWARD COMPATIBILITY
---------------------------

This fix maintains full backward compatibility:
- No code changes required
- No database schema changes
- No API changes
- Existing functionality unaffected
- Simply clears a configuration setting

If you had working service area restrictions before, you can re-configure them 
after the fix through the Settings panel.

================================================================================

üìû SUPPORT & TROUBLESHOOTING
-----------------------------

If the issue persists after applying the fix:

1. Check WordPress Debug Log
   - Enable WP_DEBUG in wp-config.php
   - Check error logs for messages starting with "PCQ:"

2. Verify Database Value
   - Check wp_options table
   - Look for option_name = 'pcq_service_area_postcodes'
   - Should be: a:0:{} (empty serialized array)

3. Clear Caches
   - WordPress object cache
   - Browser cache
   - Server-side caches (Redis, Memcached, etc.)

4. Test Validation Directly
   - Use test-spain-postal-codes.php
   - Check format validation results
   - Check service area acceptance results

5. Browser Console
   - Open Developer Tools (F12)
   - Check for JavaScript errors
   - Check network requests to AJAX endpoints

================================================================================

‚úÖ POST-FIX VERIFICATION CHECKLIST
-----------------------------------

After applying the fix, verify:

‚ñ° Run fix-service-area-spain.php - Shows "All Spain Enabled"
‚ñ° Run test-spain-postal-codes.php - 100% tests passing
‚ñ° Test postal code 26960 on live form - Accepted
‚ñ° Test postal code 28001 on live form - Accepted
‚ñ° Test postal code 01001 on live form - Accepted
‚ñ° Test postal code 52999 on live form - Accepted
‚ñ° Check Settings panel - Shows "‚úì All Spain Enabled"
‚ñ° Invalid codes (00000, 99999) - Still rejected correctly

================================================================================

üéØ QUICK SUMMARY
-----------------

Problem: Postal code 26960 rejected with "not in service area" error

Cause: Database has service area restrictions configured

Fix: Clear the service_area_postcodes option to empty array

Tools:
1. http://localhost/wecleaning/wp-content/plugins/pro-clean-quotation/fix-service-area-spain.php
2. Admin Panel ‚Üí Pro Clean Quotation ‚Üí Settings ‚Üí Service Area ‚Üí Clear field

Test:
1. http://localhost/wecleaning/wp-content/plugins/pro-clean-quotation/test-spain-postal-codes.php
2. Try postal code 26960 on quote form

Expected: All Spanish postal codes (01001-52999) accepted

================================================================================

Generated: December 31, 2025
Plugin: Pro Clean Quotation v1.1.2
Issue: Postal Code 26960 Service Area Error
Status: RESOLVED

================================================================================
